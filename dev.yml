version: '2'
services:
    nginx:
        build: ./nginx
        container_name: nginx
        ports:
          - 80:80
        depends_on:
          - andino
        networks:
          - andino-network
    andino:
        build: ./ckan-img
        container_name: andino
        ports:
          - 8800:8800
        depends_on:
           - db
           - solr
           - redis
           - postfix
        networks:
          - andino-network
        volumes:
          - $PWD:/dev-app
    fetch_consumer:
        build: ./ckan-img
        container_name: fetch_consumer
        command: /etc/ckan_init.d/run_fetch_consumer.sh
        depends_on:
           - db
           - solr
           - redis
           - postfix
        networks:
          - andino-network
        volumes:
          - $PWD:/dev-app
    gather_consumer:
        build: ./ckan-img
        container_name: gather_consumer
        command: /etc/ckan_init.d/run_gather_consumer.sh
        depends_on:
           - db
           - solr
           - redis
           - postfix
        networks:
          - andino-network
        volumes:
          - $PWD:/dev-app
    db:
        build: ./postgresql-img
        container_name: db
        networks:
          - andino-network
    redis:
        image: redis:3.2.7-alpine
        container_name: redis
        networks:
          - andino-network
    rabbitmq:
        image: rabbitmq:3.6.6-alpine
        container_name: rabbitmq
        networks:
          - andino-network
    solr:
        build: ./solr-img
        container_name: solr
        networks:
          - andino-network
    postfix:
        image: catatnight/postfix
        container_name: postfix
        ports:
          - "25:25"
          - "587:587"
        networks:
          - andino-network
networks:
  andino-network:
